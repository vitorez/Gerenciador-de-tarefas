<!-- "NAVBAR - FOTO DE PERFIL DO USUÃRIO E LUA" -->
<div class="p-4">
<header class="d-flex justify-content-end align-items-center gap-3 mb-4">
  <i class="bi bi-moon fs-5 text-secondary cursor-pointer"></i>
  <div class="d-flex align-items-center gap-2 bg-white rounded-3 px-3 py-2 shadow-sm cursor-pointer">
    <span class="fw-bold text-dark">Alencs</span>
    <img class="rounded-circle" width="40" height="40" src="https://i.pravatar.cc/40?u=alencs" alt="Foto do UsuÃ¡rio" />
  </div>
</header>

<!-- CARD DE BOAS VINDAS TOP -->
<div class="header-gradient rounded-4 p-4 p-md-5 text-white mb-4 position-relative overflow-hidden">
  <div class="position-relative" style="z-index: 1;">
    <h2 class="display-6 fw-bold mb-2"><span class="greeting-emoji">ğŸ‘‹</span> Hello, Alencs!</h2>
    <p class="opacity-75 mb-4">Welcome back! Let's make today productive and accomplish your goals.</p>
    <div class="d-flex flex-wrap gap-3">
      <div class="stat-card-custom p-3 rounded-3">
        <div class="fs-2 fw-bold">{{ todayTasksCount }}</div>
        <div class="small opacity-90">Tasks today</div>
      </div>
      <div class="stat-card-custom p-3 rounded-3">
        <div class="fs-2 fw-bold">{{ completedTodayCount }}</div>
        <div class="small opacity-90">Completed</div>
      </div>
      <div class="stat-card-custom p-3 rounded-3">
        <div class="fs-2 fw-bold">{{ todayProgressPercent }}%</div>
        <div class="small opacity-90">Progress</div>
      </div>
    </div>
  </div>
</div>

<!-- FILTRO E BARRA DE PESQUISA -->
<div class="d-flex flex-wrap gap-3 mb-4">
  <input type="text" class="form-control flex-grow-1 rounded-3" style="max-width: 400px;" placeholder="ğŸ” Search tasks..." [(ngModel)]="searchTerm" (input)="onSearchChange()">
  <button class="btn rounded-3" [class.btn-primary]="currentFilter === 'all'" [class.btn-outline-secondary]="currentFilter !== 'all'" (click)="setFilter('all')">All</button>
  <button class="btn rounded-3" [class.btn-primary]="currentFilter === 'pending'" [class.btn-outline-secondary]="currentFilter !== 'pending'" (click)="setFilter('pending')">Pending</button>
  <button class="btn rounded-3" [class.btn-primary]="currentFilter === 'completed'" [class.btn-outline-secondary]="currentFilter !== 'completed'" (click)="setFilter('completed')">Completed</button>
</div>

<!-- CARDS DE TAREFFAS - TODAY -->
<div class="card border-0 shadow-sm rounded-4 mb-4">
  <div class="card-body p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="h5 fw-bold mb-0">Today</h3>
      <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">{{ todayProgressPercent }}%</span>
    </div>
    <div class="progress mb-4" style="height: 8px;">
      <div class="progress-bar bg-gradient" [style.width.%]="todayProgressPercent"></div>
    </div>
    <ul class="list-unstyled mb-0">
      <li *ngIf="filteredTodayTasks.length === 0" class="text-center py-5 text-muted">
        <div class="fs-1 mb-2 opacity-50">ğŸ“</div>
        <div>No tasks for today. Click the + button to add one!</div>
      </li>
      <li *ngFor="let task of filteredTodayTasks" class="task-item-custom mb-2 p-3 rounded-3 border-start border-4" [class]="'border-' + task.color" [class.opacity-50]="task.completed">
        <div class="d-flex align-items-center gap-3">
          <div class="task-checkbox-custom" [class.checked]="task.completed" (click)="toggleTask(task)"></div>
          <div class="flex-grow-1 cursor-pointer" (click)="openEditor(task)">
            <div class="fw-semibold" [class.text-decoration-line-through]="task.completed">{{ task.title }}</div>
            <div class="d-flex gap-2 mt-1">
              <small class="text-muted" *ngIf="task.date || task.time">
                <span *ngIf="task.date">ğŸ“… {{ formatDate(task.date) }}</span>
                <span *ngIf="task.date && task.time"> â€¢ </span>
                <span *ngIf="task.time">ğŸ• {{ task.time }}</span>
              </small>
              <span class="badge bg-primary-subtle text-primary rounded-pill" *ngIf="task.category">{{ task.category }}</span>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<!-- CARDS DE TAREFFAS - NEXT 7 DAYS -->
<div class="card border-0 shadow-sm rounded-4 mb-4">
  <div class="card-body p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="h5 fw-bold mb-0">Next 7 Days</h3>
      <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">{{ weekProgressPercent }}%</span>
    </div>
    <div class="progress mb-4" style="height: 8px;">
      <div class="progress-bar bg-gradient" [style.width.%]="weekProgressPercent"></div>
    </div>
    <ul class="list-unstyled mb-0">
      <li *ngIf="filteredWeekTasks.length === 0" class="text-center py-5 text-muted">
        <div class="fs-1 mb-2 opacity-50">ğŸ“…</div>
        <div>No tasks for next week. Start planning ahead!</div>
      </li>
      <li *ngFor="let task of filteredWeekTasks" class="task-item-custom mb-2 p-3 rounded-3 border-start border-4" [class]="'border-' + task.color" [class.opacity-50]="task.completed">
        <div class="d-flex align-items-center gap-3">
          <div class="task-checkbox-custom" [class.checked]="task.completed" (click)="toggleTask(task)"></div>
          <div class="flex-grow-1 cursor-pointer" (click)="openEditor(task)">
            <div class="fw-semibold" [class.text-decoration-line-through]="task.completed">{{ task.title }}</div>
            <div class="d-flex gap-2 mt-1">
              <small class="text-muted" *ngIf="task.date || task.time">
                <span *ngIf="task.date">ğŸ“… {{ formatDate(task.date) }}</span>
                <span *ngIf="task.date && task.time"> â€¢ </span>
                <span *ngIf="task.time">ğŸ• {{ task.time }}</span>
              </small>
              <span class="badge bg-primary-subtle text-primary rounded-pill" *ngIf="task.category">{{ task.category }}</span>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
</div>

<!-- BOTÃƒO DE ADICIONAR TAREFA NOVA -->
<button class="add-btn" (click)="openEditor()" title="Add new task">
  <i class="bi bi-plus-lg"></i>
</button>

<div class="overlay" [class.active]="isSidebarVisible" (click)="closeEditor()"></div>

<!-- SIDEBAR DE EDIT / NEW TASK -->
<div class="offcanvas offcanvas-end" [class.show]="isSidebarVisible" tabindex="-1" style="width: 440px; visibility: visible;" [style.visibility]="isSidebarVisible ? 'visible' : 'hidden'">
<div class="offcanvas-header bg-gradient text-white">
  <h5 class="offcanvas-title fw-bold">{{ isEditMode ? 'Edit Task' : 'New Task' }}</h5>
  <button type="button" class="btn-close btn-close-white" (click)="closeEditor()"></button>
</div>
<div class="offcanvas-body">
  <div class="mb-3">
    <label class="form-label fw-semibold">Task Title *</label>
    <input type="text" class="form-control rounded-3" placeholder="Enter task title" [(ngModel)]="currentTask.title" required>
  </div>
  <div class="mb-3">
    <label class="form-label fw-semibold">Description</label>
    <textarea class="form-control rounded-3" rows="3" placeholder="Add description (optional)" [(ngModel)]="currentTask.description"></textarea>
  </div>
  <div class="mb-3">
    <label class="form-label fw-semibold">Category</label>
    <input type="text" class="form-control rounded-3" placeholder="e.g., Work, Personal, Health" [(ngModel)]="currentTask.category">
  </div>
  <div class="row mb-3">
    <div class="col-6">
      <label class="form-label fw-semibold">Due Date</label>
      <input type="date" class="form-control rounded-3" [(ngModel)]="currentTask.date">
    </div>
    <div class="col-6">
      <label class="form-label fw-semibold">Due Time</label>
      <input type="time" class="form-control rounded-3" [(ngModel)]="currentTask.timeRaw" (change)="formatTimeInput()">
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label fw-semibold">Section</label>
    <select class="form-select rounded-3" [(ngModel)]="currentTask.section">
      <option value="today">Today</option>
      <option value="week">Next 7 Days</option>
    </select>
  </div>
  <div class="mb-4">
    <label class="form-label fw-semibold">Color</label>
    <div class="d-flex gap-2">
      <div class="color-option-custom bg-success" [class.selected]="currentTask.color === 'green'" (click)="selectColor('green')" title="Green"></div>
      <div class="color-option-custom bg-danger" [class.selected]="currentTask.color === 'red'" (click)="selectColor('red')" title="Red"></div>
      <div class="color-option-custom bg-warning" [class.selected]="currentTask.color === 'yellow'" (click)="selectColor('yellow')" title="Yellow"></div>
      <div class="color-option-custom bg-primary" [class.selected]="currentTask.color === 'blue'" (click)="selectColor('blue')" title="Blue"></div>
      <div class="color-option-custom bg-purple" [class.selected]="currentTask.color === 'purple'" (click)="selectColor('purple')" title="Purple"></div>
    </div>
  </div>
  <div class="d-grid gap-2">
    <button class="btn btn-primary btn-lg rounded-3" (click)="saveTask()">Save Task</button>
    <button class="btn btn-danger btn-lg rounded-3" *ngIf="isEditMode" (click)="deleteTask()">Delete</button>
  </div>
</div>
</div>
